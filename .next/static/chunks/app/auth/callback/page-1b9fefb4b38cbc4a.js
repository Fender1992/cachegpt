(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{63:(e,r,t)=>{"use strict";var a=t(7260);t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},2855:(e,r,t)=>{"use strict";t.d(r,{N:()=>s});var a=t(5040);let o="https://slxgfzlralwbpzafbufm.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNseGdmemxyYWx3YnB6YWZidWZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzgwMzQsImV4cCI6MjA3MzU1NDAzNH0.0TRSpP_OxAde0WkVXJohGWIqlJ2CdpiYt6FAh2lz1so",s=o&&i?(0,a.UU)(o,i):(()=>{let e="Supabase is not configured. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables.";return{auth:{getUser:()=>Promise.reject(Error(e)),signInWithPassword:()=>Promise.reject(Error(e)),signUp:()=>Promise.reject(Error(e)),signOut:()=>Promise.reject(Error(e)),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}}),getSession:()=>Promise.reject(Error(e))},from:()=>({select:()=>Promise.reject(Error(e)),insert:()=>Promise.reject(Error(e)),update:()=>Promise.reject(Error(e)),delete:()=>Promise.reject(Error(e))}),rpc:()=>Promise.reject(Error(e))}})();o&&i||console.error("Missing required Supabase environment variables.","\nNEXT_PUBLIC_SUPABASE_URL:",o?"Set":"Missing","\nNEXT_PUBLIC_SUPABASE_ANON_KEY:",i?"Set (hidden)":"Missing","\n\nFor Vercel deployment:","\n1. Go to your Vercel project settings","\n2. Navigate to Environment Variables","\n3. Add both variables for Production environment","\n4. Redeploy your application")},4369:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var a=t(5155),o=t(2115),i=t(63),s=t(2855);function l(){let e=(0,i.useRouter)(),r=(0,i.useSearchParams)();return(0,o.useEffect)(()=>{(async()=>{let t=r.get("source"),a=r.get("return_to");console.log("\uD83D\uDD0D OAuth Callback Debug:",{urlSource:t,urlReturnTo:a,url:window.location.href});let o=null;try{let e=localStorage.getItem("cli_auth_flow");console.log("\uD83D\uDCF1 localStorage check:",{stored:e}),e?(o=JSON.parse(e),localStorage.removeItem("cli_auth_flow"),console.log("✅ Found CLI state in localStorage:",o)):console.log("❌ No CLI state found in localStorage")}catch(e){console.log("⚠️ localStorage error:",e)}let i="cli"===t||"terminal"===a||o&&"cli"===o.source,l=t||o&&o.source||null,n=a||o&&o.return_to||null;console.log("\uD83C\uDFAF Final CLI detection:",{isFromCLI:i,source:l,returnTo:n,urlSource:t,urlReturnTo:a,cliState:o});try{let{data:{session:r},error:t}=await s.N.auth.getSession();if(t){console.error("Error during auth callback:",t),i?e.push("/login?source=".concat(l,"&return_to=").concat(n,"&error=callback_failed")):e.push("/login?error=callback_failed");return}if(r){var c,u,d,m,p,_,g,h,v,f,b;let t=r.user,{data:a,error:o}=await s.N.from("user_profiles").select("*").eq("id",t.id).single();if(o&&"PGRST116"===o.code){let{error:e}=await s.N.from("user_profiles").insert({id:t.id,email:t.email,full_name:(null==(m=t.user_metadata)?void 0:m.full_name)||(null==(p=t.user_metadata)?void 0:p.name)||(null==(_=t.email)?void 0:_.split("@")[0]),avatar_url:(null==(g=t.user_metadata)?void 0:g.avatar_url)||(null==(h=t.user_metadata)?void 0:h.picture),provider:(null==(v=t.app_metadata)?void 0:v.provider)||"email",provider_id:(null==(f=t.user_metadata)?void 0:f.provider_id)||t.id,email_verified:!!t.email_confirmed_at,last_login_at:new Date().toISOString()});e&&console.error("Error creating user profile:",e)}else!o&&a&&await s.N.from("user_profiles").update({last_login_at:new Date().toISOString()}).eq("id",t.id);if((null==(c=t.app_metadata)?void 0:c.provider)&&"email"!==t.app_metadata.provider&&await s.N.from("oauth_providers").upsert({user_id:t.id,provider:t.app_metadata.provider,provider_user_id:(null==(b=t.user_metadata)?void 0:b.provider_id)||t.id,provider_data:t.user_metadata||{},updated_at:new Date().toISOString()},{onConflict:"user_id,provider"}),await s.N.from("usage").insert({user_id:t.id,endpoint:"/auth/callback",method:"POST",model:(null==(u=t.app_metadata)?void 0:u.provider)||"email",metadata:{provider:(null==(d=t.app_metadata)?void 0:d.provider)||"email",event:"login"}}),i){let r="/auth/success?source=".concat(l||"cli","&return_to=").concat(n||"terminal");e.push(r)}else e.push("/")}else i?e.push("/login?source=".concat(l,"&return_to=").concat(n,"&error=no_session")):e.push("/login")}catch(r){console.error("Unexpected error during auth callback:",r),i?e.push("/login?source=".concat(l,"&return_to=").concat(n,"&error=unexpected")):e.push("/login?error=unexpected")}})()},[e,r]),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-gray-800",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),(0,a.jsx)("h1",{className:"text-xl font-semibold text-white mb-2",children:"Authenticating..."}),(0,a.jsx)("p",{className:"text-gray-400",children:"Please wait while we complete your sign in."})]})})}function n(){return(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-gray-800",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),(0,a.jsx)("h1",{className:"text-xl font-semibold text-white mb-2",children:"Loading..."}),(0,a.jsx)("p",{className:"text-gray-400",children:"Preparing authentication..."})]})}),children:(0,a.jsx)(l,{})})}},8353:(e,r,t)=>{Promise.resolve().then(t.bind(t,4369))}},e=>{e.O(0,[40,441,255,358],()=>e(e.s=8353)),_N_E=e.O()}]);