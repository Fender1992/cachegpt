(()=>{var a={};a.id=276,a.ids=[276],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:a=>{"use strict";a.exports=require("punycode")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:a=>{"use strict";a.exports=require("stream")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55591:a=>{"use strict";a.exports=require("https")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65031:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>N,patchFetch:()=>M,routeModule:()=>I,serverHooks:()=>L,workAsyncStorage:()=>J,workUnitAsyncStorage:()=>K});var d={};c.r(d),c.d(d,{POST:()=>D});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(10641),v=c(91788),w=c(86802);let x=JSON.parse('{"providers":{"chatgpt":{"name":"ChatGPT","models":[{"id":"gpt-5","name":"GPT-5","default":true,"maxTokens":256000},{"id":"gpt-4-turbo-preview","name":"GPT-4 Turbo","maxTokens":128000},{"id":"gpt-4","name":"GPT-4","maxTokens":8192}]},"claude":{"name":"Claude","models":[{"id":"claude-opus-4-1-20250805","name":"Claude Opus 4.1","default":true,"maxTokens":500000},{"id":"claude-sonnet-4-20250924","name":"Claude Sonnet 4","maxTokens":300000},{"id":"claude-3-haiku-20240307","name":"Claude 3 Haiku","maxTokens":200000}]},"gemini":{"name":"Gemini","models":[{"id":"gemini-2.0-ultra","name":"Gemini 2.0 Ultra","default":true,"maxTokens":5000000},{"id":"gemini-2.0-pro","name":"Gemini 2.0 Pro","maxTokens":2000000},{"id":"gemini-1.5-flash","name":"Gemini 1.5 Flash","maxTokens":1000000}]},"perplexity":{"name":"Perplexity","models":[{"id":"pplx-pro-online","name":"Perplexity Pro Online","default":true,"maxTokens":32768},{"id":"sonar-ultra-online","name":"Sonar Ultra Online","maxTokens":32768},{"id":"llama-3-405b-instruct","name":"Llama 3 405B","maxTokens":32768}]}},"lastUpdated":"2025-09-24","updateUrl":"https://cachegpt.app/api/model-updates"}');class y{async getProviders(){return await this.checkForUpdates(),this.config.providers}async getDefaultModel(a){let b=(await this.getProviders())[a];if(!b)throw Error(`Unknown provider: ${a}`);let c=b.models.find(a=>a.default);return c?.id||b.models[0].id}async getModelsForProvider(a){let b=(await this.getProviders())[a];if(!b)throw Error(`Unknown provider: ${a}`);return b.models}async checkForUpdates(){if(!(this.lastChecked&&Date.now()-this.lastChecked.getTime()<this.checkInterval)){try{let a=await fetch(this.config.updateUrl,{method:"GET",headers:{Accept:"application/json","Cache-Control":"no-cache"},signal:AbortSignal.timeout(5e3)}).catch(()=>null);if(a?.ok){let b=await a.json();if(this.shouldUpdateConfig(this.config,b)){let a=this.config.lastUpdated;this.config=b,console.log(`LLM models configuration updated from ${a} to ${b.lastUpdated}`),this.logModelChanges(a,b)}}}catch(a){console.error("Failed to check for model updates:",a)}this.lastChecked=new Date}}shouldUpdateConfig(a,b){if(b.lastUpdated>a.lastUpdated)return!0;let c=Object.keys(a.providers||{}).length;if(Object.keys(b.providers||{}).length!==c)return!0;for(let c in b.providers){let d=a.providers?.[c]?.models||[],e=b.providers[c].models||[];if(d.length!==e.length)return!0;let f=new Set(d.map(a=>a.id)),g=new Set(e.map(a=>a.id));if(f.size!==g.size||![...f].every(a=>g.has(a)))return!0}return!1}logModelChanges(a,b){let c=[];for(let a in b.providers){let d=(b.providers[a].models||[]).find(a=>a.default);d&&c.push(`${a}: ${d.name} (${d.id})`)}c.length>0&&console.log("Active models after update:",c.join(", "))}async getMostAdvancedModel(a){let b=await this.getModelsForProvider(a);return b[0]?.id||"unknown"}constructor(){this.config=x,this.lastChecked=null,this.checkInterval=864e5}}let z=new y;async function A(a){return z.getDefaultModel(a)}let B={chatgpt:process.env.OPENAI_API_KEY,claude:process.env.ANTHROPIC_API_KEY,gemini:process.env.GOOGLE_AI_API_KEY,perplexity:process.env.PERPLEXITY_API_KEY},C="true"===process.env.FEATURE_ENTERPRISE_USER_KEYS;async function D(a){try{let b=(0,v.createRouteHandlerClient)({cookies:w.UL}),d=null;try{d=(await b.auth.getSession()).data.session}catch(a){}if(!d){let b=a.headers.get("authorization");if(b?.startsWith("Bearer ")){let a=b.substring(7),{createClient:e}=await Promise.resolve().then(c.bind(c,82461)),f=e("https://slxgfzlralwbpzafbufm.supabase.co",process.env.SUPABASE_SERVICE_KEY),{data:g,error:h}=await f.auth.getUser(a);g?.user&&(d={user:g.user,access_token:a})}}if(!d)return u.NextResponse.json({error:"Unauthorized"},{status:401});let{message:e,provider:f,model:g,messages:h}=await a.json();if(!f||!["chatgpt","claude","gemini","perplexity"].includes(f))return u.NextResponse.json({error:"Invalid provider"},{status:400});let i=B[f];if(C){let{data:a}=await b.from("user_provider_credentials").select("api_key").eq("user_id",d.user.id).eq("provider",f).single();a?.api_key&&(i=Buffer.from(a.api_key,"base64").toString("utf8"))}if(!i)return u.NextResponse.json({error:`No API key configured for ${f}. Please contact support.`},{status:500});let j="";switch(f){case"chatgpt":j=await E(i,h,g||await A("chatgpt"));break;case"claude":j=await F(i,h,g||await A("claude"));break;case"gemini":j=await G(i,h,g||await A("gemini"));break;case"perplexity":j=await H(i,h,g||await A("perplexity"))}return await b.from("usage").insert({user_id:d.user.id,endpoint:"/api/chat",method:"POST",model:g||f,metadata:{provider:f,message_count:h.length,response_length:j.length}}),u.NextResponse.json({response:j})}catch(a){return console.error("Chat API Error:",a),u.NextResponse.json({error:a.message||"Internal server error"},{status:500})}}async function E(a,b,c){let d=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({model:c,messages:b,temperature:.7,max_tokens:c.includes("gpt-5")?4096:2048})});if(!d.ok){let a=await d.text();throw Error(`OpenAI API error: ${a}`)}let e=await d.json();return e.choices[0]?.message?.content||"No response"}async function F(a,b,c){let d=b.map(a=>({role:"user"===a.role?"user":"assistant",content:a.content})),e=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":a,"anthropic-version":"2025-09-01","Content-Type":"application/json"},body:JSON.stringify({model:c,messages:d,max_tokens:c.includes("opus")?4096:2048})});if(!e.ok){let a=await e.text();throw Error(`Anthropic API error: ${a}`)}let f=await e.json();return f.content[0]?.text||"No response"}async function G(a,b,c){let d=b.map(a=>({parts:[{text:a.content}],role:"user"===a.role?"user":"model"})),e=await fetch(`https://generativelanguage.googleapis.com/v2/models/${c}:generateContent?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:d})});if(!e.ok){let a=await e.text();throw Error(`Gemini API error: ${a}`)}let f=await e.json();return f.candidates[0]?.content?.parts[0]?.text||"No response"}async function H(a,b,c){let d=await fetch("https://api.perplexity.ai/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({model:c,messages:b})});if(!d.ok){let a=await d.text();throw Error(`Perplexity API error: ${a}`)}let e=await d.json();return e.choices[0]?.message?.content||"No response"}let I=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/root/cachegpt/app/api/chat/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:J,workUnitAsyncStorage:K,serverHooks:L}=I;function M(){return(0,g.patchFetch)({workAsyncStorage:J,workUnitAsyncStorage:K})}async function N(a,b,c){var d;let e="/api/chat/route";"/index"===e&&(e="/");let g=await I.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||I.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===I.isDev||!E,H=E&&!G,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>I.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>I.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await I.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await I.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await I.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},74075:a=>{"use strict";a.exports=require("zlib")},78335:()=>{},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},81630:a=>{"use strict";a.exports=require("http")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96487:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4586,1692,2461,6717],()=>b(b.s=65031));module.exports=c})();